<!DOCTYPE html>
<html lang="th" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡πÇ‡∏Æ‡∏°‡πÄ‡∏°‡∏î ¬∑ ‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì</title>

  <!-- Tailwind + ‡∏ü‡∏≠‡∏ô‡∏ï‡πå -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    :root{
      --cream:#FFF7EF; --ink:#0F172A; --sub:#64748B; --ring:#E5E7EB;
      --primary:#16A34A; --primary-ink:#fff;
    }
    *{ font-family:'Prompt',sans-serif; }
    body{ background:linear-gradient(135deg,#fff7ef 0%,#fff3e8 45%,#ffe7d3 100%); min-height:100vh; color:var(--ink); }

    /* glass + card */
    .glass{ background:rgba(255,255,255,.65); backdrop-filter:blur(12px); border:1px solid rgba(255,255,255,.25); }
    .card{ background:rgba(255,255,255,.88); backdrop-filter:blur(12px); border:1px solid rgba(255,255,255,.35); border-radius:18px; padding:20px; box-shadow:0 12px 30px rgba(0,0,0,.06); }
    .hover-lift{ transition:transform .15s ease, box-shadow .15s ease; }
    .hover-lift:hover{ transform:translateY(-2px); box-shadow:0 16px 36px rgba(0,0,0,.08); }

    /* ‡∏õ‡∏∏‡πà‡∏° */
    .btn{ border-radius:14px; padding:.65rem 1.05rem; font-weight:700; border:1px solid var(--ring); background:#fff; }
    .btn:disabled{ opacity:.5; cursor:not-allowed; }
    .btn-line{ background:var(--primary); color:var(--primary-ink); border-color:var(--primary); }
    .btn-ghost{ background:#fff; color:#334155; }

    /* ‡πÇ‡∏°‡∏î‡∏≠‡∏• */
    .modal-bg{ position:fixed; inset:0; background:rgba(15,23,42,.45); backdrop-filter:blur(6px); display:none; place-items:center; z-index:50; padding:16px; }
    .modal-bg.show{ display:grid; animation:fadeBg .12s ease; }
    .modal-panel{ width:min(760px,92vw); background:#fff; border-radius:20px; box-shadow:0 28px 60px rgba(0,0,0,.22); transform:translateY(6px) scale(.985); animation:popIn .16s ease forwards; }
    @keyframes fadeBg{ from{background:rgba(15,23,42,0)} to{background:rgba(15,23,42,.45)}}
    @keyframes popIn{ to{ transform:translateY(0) scale(1); opacity:1 } }

    /* ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ñ‡∏ö‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏ö‡∏≠‡∏¥‡∏ô‡πÑ‡∏•‡∏ô‡πå (‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ) */
    #phone-inline{ display:none !important; }

    /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤ */
    .menu-card{ border-radius:18px; border:1px solid var(--ring); }
  </style>
</head>

<body class="h-full">
  <!-- Header -->
  <header id="liff-header" class="glass sticky top-0 z-40 border-b border-white/30">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üç´</span>
        <div>
          <div class="text-xl font-extrabold">‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡πÇ‡∏Æ‡∏°‡πÄ‡∏°‡∏î</div>
          <div class="text-sm text-emerald-700">‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì</div>
        </div>
      </div>

      <div class="right flex items-center gap-2">
        <button id="btn-account" class="btn">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
        <button id="btn-edit-phone" class="btn">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ö‡∏≠‡∏£‡πå</button>
        <button id="btn-login" class="btn btn-line">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="max-w-6xl mx-auto px-4 pt-10 pb-4 text-center">
    <div class="text-6xl mb-3">üç´</div>
    <h1 class="text-4xl font-extrabold mb-2">Brownie Studio</h1>
    <p class="text-slate-600">‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì</p>
  </section>

  <!-- ‡πÄ‡∏°‡∏ô‡∏π (‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á) -->
  <main id="main-app" class="max-w-6xl mx-auto px-4 pb-16">
    <h2 class="text-2xl font-bold mb-5">‡πÄ‡∏°‡∏ô‡∏π‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="card menu-card hover-lift">
        <div class="text-lg font-extrabold">‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡∏´‡∏ô‡∏∂‡∏ö</div>
        <div class="text-slate-500 text-sm mt-1">‡∏ä‡∏¥‡πâ‡∏ô‡∏•‡∏∞ 25 ‡∏ö‡∏≤‡∏ó</div>
      </div>
      <div class="card menu-card hover-lift">
        <div class="text-lg font-extrabold">‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡∏ü‡∏±‡∏î‡∏à‡πå</div>
        <div class="text-slate-500 text-sm mt-1">‡∏ä‡∏¥‡πâ‡∏ô‡∏•‡∏∞ 25 ‡∏ö‡∏≤‡∏ó</div>
      </div>
      <div class="card menu-card hover-lift">
        <div class="text-lg font-extrabold">‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡∏≠‡∏±‡∏•‡∏°‡∏≠‡∏ô‡∏î‡πå</div>
        <div class="text-slate-500 text-sm mt-1">‡∏ä‡∏¥‡πâ‡∏ô‡∏•‡∏∞ 25 ‡∏ö‡∏≤‡∏ó</div>
      </div>
    </div>

    <div class="text-center">
      <button id="btn-test" class="btn btn-line">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥)</button>
    </div>
  </main>

  <!-- ‡πÇ‡∏°‡∏î‡∏≠‡∏•‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å) -->
  <div id="phone-modal" class="modal-bg">
    <div class="modal-panel p-5">
      <header class="flex items-center justify-between border-b border-slate-200 pb-3">
        <div class="font-bold text-lg">‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</div>
        <button id="phone-cancel" class="text-slate-500 hover:text-slate-700 text-2xl leading-none">√ó</button>
      </header>
      <div class="p-4">
        <p class="text-slate-600 mb-2">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)</p>
        <input id="phone-input" type="tel" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678" class="w-full border rounded-xl p-3">
      </div>
      <footer class="p-4 pt-0 flex justify-end gap-2">
        <button id="phone-save" class="btn btn-line">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </footer>
    </div>
  </div>

  <!-- ‡πÇ‡∏°‡∏î‡∏≠‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ -->
  <div id="account-modal" class="modal-bg">
    <div class="modal-panel p-5">
      <header class="flex items-center justify-between border-b border-slate-200 pb-3">
        <div class="font-bold text-lg">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</div>
        <button id="acc-close" class="text-slate-500 hover:text-slate-700 text-2xl leading-none">√ó</button>
      </header>
      <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div id="profile" class="flex items-center gap-3">
          <img id="acc-pic" src="" alt="Profile" class="w-16 h-16 rounded-full object-cover border" onerror="this.src='https://placehold.co/96x96?text=%F0%9F%91%A4'">
          <div>
            <div class="font-bold" id="acc-name">-</div>
            <div class="text-slate-500 text-sm">User ID: <span id="acc-id">-</span></div>
            <div class="text-slate-500 text-sm">‡πÄ‡∏ö‡∏≠‡∏£‡πå: <span id="acc-phone">-</span></div>
          </div>
        </div>
        <div>
          <div class="font-semibold mb-2">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>
          <div id="history" class="text-slate-500 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‚Ä¶</div>
        </div>
      </div>
      <footer class="p-4 pt-0 flex justify-end">
        <button id="acc-close2" class="btn btn-line">‡∏õ‡∏¥‡∏î</button>
      </footer>
    </div>
  </div>

  <!-- Toast ‡πÄ‡∏•‡πá‡∏Å ‡πÜ -->
  <div id="toast" class="fixed bottom-6 right-6 hidden px-4 py-3 rounded-xl text-white font-semibold shadow-lg"></div>

  <script>
    /* ---------- CONFIG ---------- */
    const LIFF_ID = "2008357926-Ly07A5w2";         // <== ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const SHEET_API = "https://script.google.com/macros/s/AKfycbwyBDSpga8eMusXXDVnm1Bg19p45yoDSK_UpVDbq6j9FFlWPDN9MNnKdK0BZaAC2Ide/exec"; // <== ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

    /* ---------- STATE ---------- */
    let liffProfile=null, liffPhone=null;

    /* ---------- UTIL ---------- */
    const storageKey = (uid)=>`sk_phone_${uid}`;
    const $ = (sel)=>document.querySelector(sel);
    const show = (el)=>el.classList.add('show');
    const hide = (el)=>el.classList.remove('show');

    function openPhoneModal(){ show($('#phone-modal')); }
    function closePhoneModal(){ hide($('#phone-modal')); updateUI(); }
    function openAccount(){ show($('#account-modal')); }
    function closeAccount(){ hide($('#account-modal')); }

    function toast(msg,color='#16A34A'){
      const t = $('#toast');
      t.textContent = msg; t.style.background=color;
      t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'),2200);
    }

    function hideInlinePhone(){
      const el = document.getElementById('phone-inline');
      if(el) el.style.display='none';
    }

    /* ---------- LIFF ---------- */
    async function ensureLiff(){
      if(!liff._init){ await liff.init({ liffId: LIFF_ID }); }
      const ln = liff.getContext()?.type;
      // ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å LINE ‚Üí ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" ‡πÄ‡∏≠‡∏á
      $('#btn-login').onclick = async()=>{
        try{
          await ensureLiff();
          if(!liff.isLoggedIn()) liff.login({ redirectUri: location.href });
        }catch(e){ console.error(e); toast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', '#ef4444'); }
      };
    }

    async function onLoggedIn(){
      try{
        await ensureLiff();
        if(!liff.isLoggedIn()){ $('#btn-login').classList.remove('hidden'); return; }
        const p = await liff.getProfile();
        liffProfile = { userId:p.userId, displayName:p.displayName, pictureUrl:p.pictureUrl };
        try{ liffPhone = localStorage.getItem(storageKey(p.userId)); }catch(_){}
        hideInlinePhone();
        if(!liffPhone) openPhoneModal(); else updateUI();
      }catch(e){ console.error(e); }
    }

    /* ---------- PHONE MODAL ---------- */
    $('#phone-save').onclick = async ()=>{
      const v = ($('#phone-input').value||'').replace(/\s+/g,'');
      if(!/^\d{9,10}$/.test(v)){ toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', '#ef4444'); return; }
      try{
        if(liffProfile?.userId) localStorage.setItem(storageKey(liffProfile.userId), v);
      }catch(_){}
      liffPhone = v;
      closePhoneModal();
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô Google Sheet (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
      try{
        await fetch(SHEET_API, { method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ type:'savePhone', userId:liffProfile?.userId, name:liffProfile?.displayName, phone:v })
        });
      }catch(_){}
      toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    };
    $('#phone-cancel').onclick = closePhoneModal;

    /* ---------- ACCOUNT MODAL ---------- */
    $('#btn-account').onclick = openAccount;
    $('#acc-close').onclick = closeAccount;
    $('#acc-close2').onclick = closeAccount;

    $('#btn-edit-phone').onclick = ()=>{
      $('#phone-input').value = liffPhone||'';
      openPhoneModal();
    };

    function updateUI(){
      // ‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤
      $('#btn-login').classList.add('hidden');
      $('#acc-name').textContent = liffProfile?.displayName || '-';
      $('#acc-id').textContent = liffProfile?.userId || '-';
      $('#acc-phone').textContent = liffPhone || '-';
      $('#acc-pic').src = liffProfile?.pictureUrl || '';
    }

    /* ---------- DEMO: ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ -> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ---------- */
    $('#btn-test').onclick = async ()=>{
      if(!liffProfile){ toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '#ef4444'); return; }
      if(!liffPhone){ openPhoneModal(); return; }
      // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡∏á‡∏ä‡∏µ‡∏ï
      try{
        await fetch(SHEET_API, { method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ type:'addOrder', userId:liffProfile.userId, name:liffProfile.displayName, phone:liffPhone, items:['‡∏ó‡∏î‡∏™‡∏≠‡∏ö'], amount:25 })
        });
        $('#history').textContent = '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (25 ‡∏ö‡∏≤‡∏ó) ‚Ä¢ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß';
        toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
      }catch(e){ console.error(e); toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '#ef4444'); }
    };

    /* ---------- START ---------- */
    window.addEventListener('keydown', e=>{
      if(e.key==='Escape'){ closeAccount(); closePhoneModal(); }
      // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏â‡∏≤‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î
      document.querySelectorAll('.modal-bg').forEach(bg=>{
        bg.onclick = (evt)=>{ if(evt.target===bg){ bg.classList.remove('show'); } };
      });
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    (async()=>{ await ensureLiff(); onLoggedIn(); })();
  </script>
</body>
</html>
