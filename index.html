<!DOCTYPE html>
<html lang="th" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡πÇ‡∏Æ‡∏°‡πÄ‡∏°‡∏î - ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Prompt', sans-serif;
        }
        
        .slide-down {
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .bounce {
            animation: bounce 0.3s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .coin-float {
            animation: coinFloat 2s ease-out;
        }
        
        @keyframes coinFloat {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) rotate(360deg);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .selected {
            background: linear-gradient(135deg, #f3e8ff, #e0e7ff);
            border-color: #8b5cf6;
        }
        
        .topping-selected {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-color: #f59e0b;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-50 min-h-full">
    <!-- Header with Points and Login (Hidden on mode selection) -->
    <header id="main-header" class="bg-gradient-to-r from-yellow-100 to-amber-100 shadow-sm hidden">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <!-- Points Section (Left) -->
                <div class="flex items-center space-x-2">
                    <div class="text-2xl">ü™ô</div>
                    <span class="text-lg font-medium text-amber-800">
                        ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°: <span id="points" class="font-bold">128</span> ‡πÅ‡∏ï‡πâ‡∏°
                    </span>
                </div>
                
                <!-- Login Section (Right) -->
                <div class="flex items-center space-x-3">
                    <div id="login-status" class="text-sm text-amber-700">
                        <span id="guest-status" class="flex items-center space-x-1">
                            <span>üë§</span>
                            <span>‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏° (‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°)</span>
                        </span>
                        <span id="user-status" class="hidden flex items-center space-x-1">
                            <span>‚úÖ</span>
                            <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>
                        </span>
                    </div>
                    <button id="history-btn" onclick="showOrderHistory()" class="hidden bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium text-sm transition-colors">
                        üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                    </button>
                    <button id="login-btn" onclick="toggleLogin()" class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg font-medium text-sm transition-colors">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                    <button id="logout-btn" onclick="toggleLogin()" class="hidden bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium text-sm transition-colors">
                        ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Mode Selection Screen -->
    <div id="mode-selection" class="max-w-2xl mx-auto px-4 py-16">
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-amber-900 mb-4">üç´ ‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡πÇ‡∏Æ‡∏°‡πÄ‡∏°‡∏î</h1>
            <p class="text-xl text-amber-700 mb-8">‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì</p>
            <p class="text-lg text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Guest Mode -->
            <div class="bg-white rounded-2xl shadow-lg p-8 border-2 border-gray-200 hover:border-amber-300 hover:shadow-xl transition-all cursor-pointer" onclick="selectMode('guest')">
                <div class="text-center">
                    <div class="text-6xl mb-4">üë§</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°</h3>
                    <div class="space-y-3 text-left">
                        <div class="flex items-center space-x-2">
                            <span class="text-green-500">‚úì</span>
                            <span class="text-gray-700">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-green-500">‚úì</span>
                            <span class="text-gray-700">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-red-500">‚úó</span>
                            <span class="text-gray-700">‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-red-500">‚úó</span>
                            <span class="text-gray-700">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</span>
                        </div>
                    </div>
                    <button onclick="selectMode('guest')" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-semibold transition-colors w-full">
                        ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢
                    </button>
                </div>
            </div>
            
            <!-- Member Mode -->
            <div class="bg-white rounded-2xl shadow-lg p-8 border-2 border-amber-300 hover:border-amber-400 hover:shadow-xl transition-all cursor-pointer" onclick="selectMode('member')">
                <div class="text-center">
                    <div class="text-6xl mb-4">‚≠ê</div>
                    <h3 class="text-2xl font-bold text-amber-800 mb-4">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
                    <div class="space-y-3 text-left">
                        <div class="flex items-center space-x-2">
                            <span class="text-green-500">‚úì</span>
                            <span class="text-gray-700">‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡∏∑‡πâ‡∏≠</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-green-500">‚úì</span>
                            <span class="text-gray-700">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-green-500">‚úì</span>
                            <span class="text-gray-700">‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏à‡∏Å‡∏Ç‡∏≠‡∏á</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-green-500">‚úì</span>
                            <span class="text-gray-700">‡∏°‡∏µ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span>
                        </div>
                    </div>
                    <button onclick="selectMode('member')" class="mt-6 bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-xl font-semibold transition-colors w-full">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login/Register Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
                <div class="p-6">
                    <!-- Login Form -->
                    <div id="login-form">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
                        <form onsubmit="handleLogin(event)">
                            <div class="space-y-4">
                                <div>
                                    <label for="login-username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                                    <input type="text" id="login-username" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Username ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                                </div>
                                <div>
                                    <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <input type="password" id="login-password" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                                </div>
                            </div>
                            <button type="submit" class="w-full mt-6 bg-amber-500 hover:bg-amber-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                            </button>
                        </form>
                        <div class="mt-4 text-center">
                            <p class="text-gray-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? 
                                <button onclick="showRegisterForm()" class="text-amber-600 hover:text-amber-700 font-semibold">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                            </p>
                        </div>
                    </div>

                    <!-- Register Form -->
                    <div id="register-form" class="hidden">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
                        <form onsubmit="handleRegister(event)">
                            <div class="space-y-4">
                                <div>
                                    <label for="register-username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                                    <input type="text" id="register-username" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Username ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                                </div>
                                <div>
                                    <label for="register-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <input type="password" id="register-password" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)" minlength="6">
                                </div>
                                <div>
                                    <label for="register-name" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠ (‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô)</label>
                                    <input type="text" id="register-name" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                                </div>
                                <div>
                                    <label for="register-line" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏•‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</label>
                                    <input type="text" id="register-line" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏•‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                                </div>
                            </div>
                            <button type="submit" class="w-full mt-6 bg-emerald-500 hover:bg-emerald-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                            </button>
                        </form>
                        <div class="mt-4 text-center">
                            <p class="text-gray-600">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? 
                                <button onclick="showLoginForm()" class="text-amber-600 hover:text-amber-700 font-semibold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                            </p>
                        </div>
                    </div>

                    <div class="mt-6 text-center">
                        <button onclick="closeLoginModal()" class="text-gray-500 hover:text-gray-700">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main id="main-app" class="max-w-4xl mx-auto px-4 py-8 hidden">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-amber-900 mb-2">üç´ ‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡πÇ‡∏Æ‡∏°‡πÄ‡∏°‡∏î</h1>
            <p class="text-lg text-amber-700">‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì</p>
        </div>

        <!-- Brownie Base Selection -->
        <section class="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                <span class="mr-2">üç´</span>
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö)
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="brownie-base border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBase('cocoa', this)">
                    <div class="text-center">
                        <div class="text-3xl mb-2">üç´</div>
                        <h3 class="font-semibold text-gray-800">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÇ‡∏Å‡πÇ‡∏Å‡πâ</h3>
                        <p class="text-sm text-gray-600 mt-1">‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡πÅ‡∏ó‡πâ‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô</p>
                        <div class="base-quantity-controls mt-2 hidden">
                            <div class="flex items-center justify-center space-x-2">
                                <button onclick="changeBaseQuantity('cocoa', -1, event)" class="bg-red-100 hover:bg-red-200 text-red-600 w-6 h-6 rounded-full text-sm font-bold">-</button>
                                <span class="base-quantity font-semibold">0</span>
                                <button onclick="changeBaseQuantity('cocoa', 1, event)" class="bg-green-100 hover:bg-green-200 text-green-600 w-6 h-6 rounded-full text-sm font-bold">+</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="brownie-base border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBase('greentea', this)">
                    <div class="text-center">
                        <div class="text-3xl mb-2">üçÉ</div>
                        <h3 class="font-semibold text-gray-800">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</h3>
                        <p class="text-sm text-gray-600 mt-1">‡∏´‡∏≠‡∏°‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÅ‡∏ó‡πâ</p>
                        <div class="base-quantity-controls mt-2 hidden">
                            <div class="flex items-center justify-center space-x-2">
                                <button onclick="changeBaseQuantity('greentea', -1, event)" class="bg-red-100 hover:bg-red-200 text-red-600 w-6 h-6 rounded-full text-sm font-bold">-</button>
                                <span class="base-quantity font-semibold">0</span>
                                <button onclick="changeBaseQuantity('greentea', 1, event)" class="bg-green-100 hover:bg-green-200 text-green-600 w-6 h-6 rounded-full text-sm font-bold">+</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="brownie-base border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBase('thaitea', this)">
                    <div class="text-center">
                        <div class="text-3xl mb-2">üß°</div>
                        <h3 class="font-semibold text-gray-800">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢</h3>
                        <p class="text-sm text-gray-600 mt-1">‡∏´‡∏ß‡∏≤‡∏ô‡∏´‡∏≠‡∏°‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢‡πÅ‡∏ó‡πâ</p>
                        <div class="base-quantity-controls mt-2 hidden">
                            <div class="flex items-center justify-center space-x-2">
                                <button onclick="changeBaseQuantity('thaitea', -1, event)" class="bg-red-100 hover:bg-red-200 text-red-600 w-6 h-6 rounded-full text-sm font-bold">-</button>
                                <span class="base-quantity font-semibold">0</span>
                                <button onclick="changeBaseQuantity('thaitea', 1, event)" class="bg-green-100 hover:bg-green-200 text-green-600 w-6 h-6 rounded-full text-sm font-bold">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Toppings Selection (Hidden initially) -->
        <section id="toppings-section" class="bg-white rounded-2xl shadow-lg p-6 mb-6 hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                <span class="mr-2">üç™</span>
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠)
            </h2>
            <div id="remaining-toppings" class="text-center mb-4 p-3 bg-blue-50 rounded-lg">
                <span class="text-blue-700 font-medium">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏µ‡∏Å <span id="remaining-count">0</span> ‡∏ä‡∏¥‡πâ‡∏ô</span>
            </div>
            
            <!-- Single Base Toppings -->
            <div id="single-base-toppings" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleTopping('chocolate', this)">
                        <div class="text-center">
                            <div class="text-3xl mb-2">üç´</div>
                            <h3 class="font-medium text-gray-800">‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏ä‡∏¥‡∏û</h3>
                            <p class="text-sm text-gray-600 mt-1">‡∏´‡∏≠‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô</p>
                            <div class="quantity-controls mt-2 hidden">
                                <div class="flex items-center justify-center space-x-2">
                                    <button onclick="changeQuantity('chocolate', -1, event)" class="bg-red-100 hover:bg-red-200 text-red-600 w-6 h-6 rounded-full text-sm font-bold">-</button>
                                    <span class="quantity font-semibold">0</span>
                                    <button onclick="changeQuantity('chocolate', 1, event)" class="bg-green-100 hover:bg-green-200 text-green-600 w-6 h-6 rounded-full text-sm font-bold">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleTopping('almond', this)">
                        <div class="text-center">
                            <div class="text-3xl mb-2">üå∞</div>
                            <h3 class="font-medium text-gray-800">‡∏≠‡∏±‡∏•‡∏°‡∏≠‡∏ô‡∏î‡πå‡πÅ‡∏ú‡πà‡∏ô</h3>
                            <p class="text-sm text-gray-600 mt-1">‡∏Å‡∏£‡∏≠‡∏ö‡∏´‡∏≠‡∏°‡∏ô‡∏±‡∏ó</p>
                            <div class="quantity-controls mt-2 hidden">
                                <div class="flex items-center justify-center space-x-2">
                                    <button onclick="changeQuantity('almond', -1, event)" class="bg-red-100 hover:bg-red-200 text-red-600 w-6 h-6 rounded-full text-sm font-bold">-</button>
                                    <span class="quantity font-semibold">0</span>
                                    <button onclick="changeQuantity('almond', 1, event)" class="bg-green-100 hover:bg-green-200 text-green-600 w-6 h-6 rounded-full text-sm font-bold">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleTopping('oreo', this)">
                        <div class="text-center">
                            <div class="text-3xl mb-2">üç™</div>
                            <h3 class="font-medium text-gray-800">‡πÇ‡∏≠‡∏£‡∏¥‡πÇ‡∏≠‡πâ‡∏ö‡∏î</h3>
                            <p class="text-sm text-gray-600 mt-1">‡∏Å‡∏£‡∏≠‡∏ö‡∏´‡∏ß‡∏≤‡∏ô‡∏°‡∏±‡∏ô</p>
                            <div class="quantity-controls mt-2 hidden">
                                <div class="flex items-center justify-center space-x-2">
                                    <button onclick="changeQuantity('oreo', -1, event)" class="bg-red-100 hover:bg-red-200 text-red-600 w-6 h-6 rounded-full text-sm font-bold">-</button>
                                    <span class="quantity font-semibold">0</span>
                                    <button onclick="changeQuantity('oreo', 1, event)" class="bg-green-100 hover:bg-green-200 text-green-600 w-6 h-6 rounded-full text-sm font-bold">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Multiple Base Toppings -->
            <div id="multiple-base-toppings" class="hidden space-y-6">
                <!-- Cocoa Toppings -->
                <div id="cocoa-toppings" class="hidden">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center">
                        <span class="mr-2">üç´</span>
                        ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÇ‡∏Å‡πÇ‡∏Å‡πâ (<span id="cocoa-remaining">0</span> ‡∏ä‡∏¥‡πâ‡∏ô)
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBaseTopping('cocoa', 'chocolate', this)">
                            <div class="text-center">
                                <div class="text-2xl mb-2">üç´</div>
                                <h4 class="font-medium text-gray-800 text-sm">‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏ä‡∏¥‡∏û</h4>
                                <div class="base-topping-quantity mt-2">
                                    <span class="font-semibold text-sm">0 ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </div>
                            </div>
                        </div>
                        <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBaseTopping('cocoa', 'almond', this)">
                            <div class="text-center">
                                <div class="text-2xl mb-2">üå∞</div>
                                <h4 class="font-medium text-gray-800 text-sm">‡∏≠‡∏±‡∏•‡∏°‡∏≠‡∏ô‡∏î‡πå‡πÅ‡∏ú‡πà‡∏ô</h4>
                                <div class="base-topping-quantity mt-2">
                                    <span class="font-semibold text-sm">0 ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </div>
                            </div>
                        </div>
                        <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBaseTopping('cocoa', 'oreo', this)">
                            <div class="text-center">
                                <div class="text-2xl mb-2">üç™</div>
                                <h4 class="font-medium text-gray-800 text-sm">‡πÇ‡∏≠‡∏£‡∏¥‡πÇ‡∏≠‡πâ‡∏ö‡∏î</h4>
                                <div class="base-topping-quantity mt-2">
                                    <span class="font-semibold text-sm">0 ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Green Tea Toppings -->
                <div id="greentea-toppings" class="hidden">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center">
                        <span class="mr-2">üçÉ</span>
                        ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (<span id="greentea-remaining">0</span> ‡∏ä‡∏¥‡πâ‡∏ô)
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBaseTopping('greentea', 'chocolate', this)">
                            <div class="text-center">
                                <div class="text-2xl mb-2">üç´</div>
                                <h4 class="font-medium text-gray-800 text-sm">‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏ä‡∏¥‡∏û</h4>
                                <div class="base-topping-quantity mt-2">
                                    <span class="font-semibold text-sm">0 ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </div>
                            </div>
                        </div>
                        <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBaseTopping('greentea', 'almond', this)">
                            <div class="text-center">
                                <div class="text-2xl mb-2">üå∞</div>
                                <h4 class="font-medium text-gray-800 text-sm">‡∏≠‡∏±‡∏•‡∏°‡∏≠‡∏ô‡∏î‡πå‡πÅ‡∏ú‡πà‡∏ô</h4>
                                <div class="base-topping-quantity mt-2">
                                    <span class="font-semibold text-sm">0 ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </div>
                            </div>
                        </div>
                        <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBaseTopping('greentea', 'oreo', this)">
                            <div class="text-center">
                                <div class="text-2xl mb-2">üç™</div>
                                <h4 class="font-medium text-gray-800 text-sm">‡πÇ‡∏≠‡∏£‡∏¥‡πÇ‡∏≠‡πâ‡∏ö‡∏î</h4>
                                <div class="base-topping-quantity mt-2">
                                    <span class="font-semibold text-sm">0 ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Thai Tea Toppings -->
                <div id="thaitea-toppings" class="hidden">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center">
                        <span class="mr-2">üß°</span>
                        ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢ (<span id="thaitea-remaining">0</span> ‡∏ä‡∏¥‡πâ‡∏ô)
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBaseTopping('thaitea', 'chocolate', this)">
                            <div class="text-center">
                                <div class="text-2xl mb-2">üç´</div>
                                <h4 class="font-medium text-gray-800 text-sm">‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏ä‡∏¥‡∏û</h4>
                                <div class="base-topping-quantity mt-2">
                                    <span class="font-semibold text-sm">0 ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </div>
                            </div>
                        </div>
                        <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBaseTopping('thaitea', 'almond', this)">
                            <div class="text-center">
                                <div class="text-2xl mb-2">üå∞</div>
                                <h4 class="font-medium text-gray-800 text-sm">‡∏≠‡∏±‡∏•‡∏°‡∏≠‡∏ô‡∏î‡πå‡πÅ‡∏ú‡πà‡∏ô</h4>
                                <div class="base-topping-quantity mt-2">
                                    <span class="font-semibold text-sm">0 ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </div>
                            </div>
                        </div>
                        <div class="topping-item border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleBaseTopping('thaitea', 'oreo', this)">
                            <div class="text-center">
                                <div class="text-2xl mb-2">üç™</div>
                                <h4 class="font-medium text-gray-800 text-sm">‡πÇ‡∏≠‡∏£‡∏¥‡πÇ‡∏≠‡πâ‡∏ö‡∏î</h4>
                                <div class="base-topping-quantity mt-2">
                                    <span class="font-semibold text-sm">0 ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Order Summary -->
        <section id="order-summary" class="bg-white rounded-2xl shadow-lg p-6 mb-6 hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                <span class="mr-2">üßæ</span>
                ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
            </h2>
            <div id="summary-content" class="space-y-2 text-gray-700">
                <!-- Summary will be populated here -->
            </div>
        </section>

        <!-- Total Price Section -->
        <section class="bg-gradient-to-r from-green-100 to-emerald-100 rounded-2xl shadow-lg p-6">
            <div class="text-center">
                <div class="text-3xl font-bold text-emerald-800 mb-4">
                    ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="total-price">0</span> ‡∏ö‡∏≤‡∏ó
                </div>
                <button id="check-order-btn" onclick="showOrderCheck()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-8 py-3 rounded-xl font-semibold text-lg transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                    ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                </button>
            </div>
        </section>

        <!-- Order Confirmation Modal -->
        <div id="order-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-full p-4">
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
                    <div class="p-6">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
                        <div id="final-summary" class="bg-gray-50 rounded-xl p-4 mb-4">
                            <!-- Final summary will be populated here -->
                        </div>
                        
                        <!-- Guest Information Form (Only for guests) -->
                        <div id="guest-info-form" class="hidden mb-4">
                            <h4 class="text-lg font-semibold text-gray-800 mb-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h4>
                            <form id="guest-form" onsubmit="handleGuestOrder(event)">
                                <div class="space-y-3">
                                    <div>
                                        <label for="guest-name" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠ (‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô)</label>
                                        <input type="text" id="guest-name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                                    </div>
                                    <div>
                                        <label for="guest-line" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏•‡∏ô‡πå (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠)</label>
                                        <input type="text" id="guest-line" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏•‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                                    </div>
                                </div>
                                <button type="submit" class="w-full mt-4 bg-emerald-500 hover:bg-emerald-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                                </button>
                            </form>
                        </div>
                        
                        <!-- Member Confirmation Buttons -->
                        <div id="member-buttons" class="flex space-x-3">
                            <button onclick="closeOrderModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-xl font-semibold transition-colors">
                                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                            </button>
                            <button onclick="confirmOrder()" class="flex-1 bg-emerald-500 hover:bg-emerald-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Message -->
        <div id="success-message" class="fixed top-20 right-4 bg-emerald-500 text-white px-6 py-4 rounded-xl shadow-lg hidden z-50">
            <div class="text-center">
                <div class="text-2xl mb-2">üéâ</div>
                <div id="success-text" class="font-semibold"></div>
            </div>
        </div>

        <!-- Floating Coins -->
        <div id="floating-coins" class="fixed inset-0 pointer-events-none z-40"></div>
    </main>

    <!-- Order History Modal -->
    <div id="history-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-full p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                            <span class="mr-2">üìã</span>
                            ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                        </h3>
                        <button onclick="closeHistoryModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                    </div>
                    
                    <div id="history-content" class="max-h-[60vh] overflow-y-auto">
                        <!-- History items will be populated here -->
                    </div>
                    
                    <div class="mt-6 text-center">
                        <button onclick="closeHistoryModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-xl font-semibold transition-colors">
                            ‡∏õ‡∏¥‡∏î
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script>
        let selectedBases = {};
        let selectedToppings = {};
        let baseToppings = {}; // For multiple bases: {base: {topping: quantity}}
        let currentPoints = 128;
        let isLoggedIn = false;
        let currentUser = null;
        let orderHistory = [];
        
        const baseNames = {
            'cocoa': '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÇ‡∏Å‡πÇ‡∏Å‡πâ',
            'greentea': '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß',
            'thaitea': '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢'
        };
        
        const toppingNames = {
            'chocolate': '‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏ä‡∏¥‡∏û',
            'almond': '‡∏≠‡∏±‡∏•‡∏°‡∏≠‡∏ô‡∏î‡πå‡πÅ‡∏ú‡πà‡∏ô',
            'oreo': '‡πÇ‡∏≠‡∏£‡∏¥‡πÇ‡∏≠‡πâ‡∏ö‡∏î'
        };

        function toggleBase(base, element) {
            const quantityControls = element.querySelector('.base-quantity-controls');
            
            if (!selectedBases[base]) {
                selectedBases[base] = 1;
                element.classList.add('selected');
                quantityControls.classList.remove('hidden');
                quantityControls.querySelector('.base-quantity').textContent = '1';
            } else {
                delete selectedBases[base];
                delete baseToppings[base]; // Clear toppings for this base
                element.classList.remove('selected');
                quantityControls.classList.add('hidden');
                quantityControls.querySelector('.base-quantity').textContent = '0';
            }
            
            // Show toppings section if any base is selected
            const toppingsSection = document.getElementById('toppings-section');
            if (Object.keys(selectedBases).length > 0) {
                toppingsSection.classList.remove('hidden');
                toppingsSection.classList.add('slide-down');
                updateToppingsDisplay();
            } else {
                toppingsSection.classList.add('hidden');
                // Reset all toppings
                selectedToppings = {};
                baseToppings = {};
            }
            
            updateOrderSummary();
        }

        function updateToppingsDisplay() {
            const selectedBaseCount = Object.keys(selectedBases).length;
            const singleBaseToppings = document.getElementById('single-base-toppings');
            const multipleBaseToppings = document.getElementById('multiple-base-toppings');
            
            if (selectedBaseCount === 1) {
                // Single base - show regular topping selection
                singleBaseToppings.classList.remove('hidden');
                multipleBaseToppings.classList.add('hidden');
                updateRemainingCount();
            } else if (selectedBaseCount > 1) {
                // Multiple bases - show separate sections for each base
                singleBaseToppings.classList.add('hidden');
                multipleBaseToppings.classList.remove('hidden');
                
                // Show sections for selected bases
                Object.keys(selectedBases).forEach(base => {
                    const section = document.getElementById(`${base}-toppings`);
                    if (section) {
                        section.classList.remove('hidden');
                        updateBaseRemainingCount(base);
                    }
                });
                
                // Hide sections for unselected bases
                ['cocoa', 'greentea', 'thaitea'].forEach(base => {
                    if (!selectedBases[base]) {
                        const section = document.getElementById(`${base}-toppings`);
                        if (section) {
                            section.classList.add('hidden');
                        }
                    }
                });
            }
        }

        function changeBaseQuantity(base, change, event) {
            event.stopPropagation();
            
            const button = event.target;
            button.classList.add('bounce');
            setTimeout(() => button.classList.remove('bounce'), 300);
            
            if (selectedBases[base]) {
                selectedBases[base] += change;
                
                if (selectedBases[base] <= 0) {
                    delete selectedBases[base];
                    delete baseToppings[base];
                    const baseElement = button.closest('.brownie-base');
                    baseElement.classList.remove('selected');
                    baseElement.querySelector('.base-quantity-controls').classList.add('hidden');
                    baseElement.querySelector('.base-quantity').textContent = '0';
                    
                    // Hide toppings if no bases selected
                    if (Object.keys(selectedBases).length === 0) {
                        document.getElementById('toppings-section').classList.add('hidden');
                        selectedToppings = {};
                        baseToppings = {};
                    } else {
                        updateToppingsDisplay();
                    }
                } else {
                    button.closest('.base-quantity-controls').querySelector('.base-quantity').textContent = selectedBases[base];
                    updateToppingsDisplay();
                }
                
                updateOrderSummary();
            }
        }

        function updateRemainingCount() {
            const totalBases = Object.values(selectedBases).reduce((sum, qty) => sum + qty, 0);
            const totalToppings = Object.values(selectedToppings).reduce((sum, qty) => sum + qty, 0);
            const remaining = totalBases - totalToppings;
            
            document.getElementById('remaining-count').textContent = Math.max(0, remaining);
            
            const remainingDiv = document.getElementById('remaining-toppings');
            if (remaining <= 0) {
                remainingDiv.classList.add('hidden');
            } else {
                remainingDiv.classList.remove('hidden');
            }
        }

        function updateBaseRemainingCount(base) {
            const baseQuantity = selectedBases[base] || 0;
            const baseToppingTotal = baseToppings[base] ? Object.values(baseToppings[base]).reduce((sum, qty) => sum + qty, 0) : 0;
            const remaining = baseQuantity - baseToppingTotal;
            
            const remainingSpan = document.getElementById(`${base}-remaining`);
            if (remainingSpan) {
                remainingSpan.textContent = Math.max(0, remaining);
            }
        }

        function toggleTopping(topping, element) {
            const totalBases = Object.values(selectedBases).reduce((sum, qty) => sum + qty, 0);
            const totalToppings = Object.values(selectedToppings).reduce((sum, qty) => sum + qty, 0);
            
            const quantityControls = element.querySelector('.quantity-controls');
            
            if (!selectedToppings[topping]) {
                if (totalToppings < totalBases) {
                    selectedToppings[topping] = 1;
                    element.classList.add('topping-selected');
                    quantityControls.classList.remove('hidden');
                    quantityControls.querySelector('.quantity').textContent = '1';
                }
            } else {
                delete selectedToppings[topping];
                element.classList.remove('topping-selected');
                quantityControls.classList.add('hidden');
                quantityControls.querySelector('.quantity').textContent = '0';
            }
            
            updateRemainingCount();
            updateOrderSummary();
        }

        function changeQuantity(topping, change, event) {
            event.stopPropagation();
            
            const button = event.target;
            button.classList.add('bounce');
            setTimeout(() => button.classList.remove('bounce'), 300);
            
            const totalBases = Object.values(selectedBases).reduce((sum, qty) => sum + qty, 0);
            const totalToppings = Object.values(selectedToppings).reduce((sum, qty) => sum + qty, 0);
            
            if (selectedToppings[topping]) {
                const newQuantity = selectedToppings[topping] + change;
                
                if (newQuantity <= 0) {
                    delete selectedToppings[topping];
                    const toppingElement = button.closest('.topping-item');
                    toppingElement.classList.remove('topping-selected');
                    toppingElement.querySelector('.quantity-controls').classList.add('hidden');
                    toppingElement.querySelector('.quantity').textContent = '0';
                } else if (totalToppings - selectedToppings[topping] + newQuantity <= totalBases) {
                    selectedToppings[topping] = newQuantity;
                    button.closest('.quantity-controls').querySelector('.quantity').textContent = newQuantity;
                }
                
                updateRemainingCount();
                updateOrderSummary();
            }
        }

        function toggleBaseTopping(base, topping, element) {
            if (!baseToppings[base]) {
                baseToppings[base] = {};
            }
            
            const baseQuantity = selectedBases[base] || 0;
            const baseToppingTotal = Object.values(baseToppings[base]).reduce((sum, qty) => sum + qty, 0);
            
            if (!baseToppings[base][topping]) {
                if (baseToppingTotal < baseQuantity) {
                    baseToppings[base][topping] = 1;
                    element.classList.add('topping-selected');
                    element.querySelector('.base-topping-quantity span').textContent = '1 ‡∏ä‡∏¥‡πâ‡∏ô';
                }
            } else {
                const currentQty = baseToppings[base][topping];
                const newQty = currentQty + 1;
                
                if (baseToppingTotal - currentQty + newQty <= baseQuantity) {
                    baseToppings[base][topping] = newQty;
                    element.querySelector('.base-topping-quantity span').textContent = `${newQty} ‡∏ä‡∏¥‡πâ‡∏ô`;
                } else {
                    // Remove if at max
                    delete baseToppings[base][topping];
                    element.classList.remove('topping-selected');
                    element.querySelector('.base-topping-quantity span').textContent = '0 ‡∏ä‡∏¥‡πâ‡∏ô';
                }
            }
            
            updateBaseRemainingCount(base);
            updateOrderSummary();
        }

        function updateOrderSummary() {
            const summarySection = document.getElementById('order-summary');
            const summaryContent = document.getElementById('summary-content');
            const totalPriceElement = document.getElementById('total-price');
            const checkOrderBtn = document.getElementById('check-order-btn');
            
            const hasItems = Object.keys(selectedBases).length > 0 || Object.keys(baseToppings).length > 0 || Object.keys(selectedToppings).length > 0;
            
            if (!hasItems) {
                summarySection.classList.add('hidden');
                totalPriceElement.textContent = '0';
                checkOrderBtn.disabled = true;
                return;
            }
            
            let summaryHTML = '';
            let totalPrice = 0;
            let totalBrownieCount = 0;
            
            const selectedBaseCount = Object.keys(selectedBases).length;
            
            if (selectedBaseCount === 1) {
                // Single base mode
                Object.entries(selectedBases).forEach(([base, quantity]) => {
                    totalBrownieCount += quantity;
                    summaryHTML += `<div class="mb-3"><strong>${baseNames[base]} x ${quantity} ‡∏ä‡∏¥‡πâ‡∏ô</strong></div>`;
                });
                
                Object.entries(selectedToppings).forEach(([topping, quantity]) => {
                    summaryHTML += `<div class="ml-4 text-sm">‚Ä¢ ‡∏´‡∏ô‡πâ‡∏≤ ${toppingNames[topping]} x ${quantity} ‡∏ä‡∏¥‡πâ‡∏ô</div>`;
                });
                
                // Calculate price: base price + topping price
                const basePrice = totalBrownieCount * 25;
                const toppingPrice = Object.values(selectedToppings).reduce((sum, qty) => sum + qty, 0) * 15;
                totalPrice = basePrice + toppingPrice;
                
            } else if (selectedBaseCount > 1) {
                // Multiple base mode
                Object.entries(selectedBases).forEach(([base, quantity]) => {
                    totalBrownieCount += quantity;
                    summaryHTML += `<div class="mb-2"><strong>${baseNames[base]} x ${quantity} ‡∏ä‡∏¥‡πâ‡∏ô</strong></div>`;
                    
                    if (baseToppings[base]) {
                        Object.entries(baseToppings[base]).forEach(([topping, toppingQty]) => {
                            summaryHTML += `<div class="ml-4 text-sm">‚Ä¢ ‡∏´‡∏ô‡πâ‡∏≤ ${toppingNames[topping]} x ${toppingQty} ‡∏ä‡∏¥‡πâ‡∏ô</div>`;
                        });
                    }
                    summaryHTML += '<div class="mb-2"></div>';
                });
                
                // Calculate price for multiple bases
                const basePrice = totalBrownieCount * 25;
                let toppingPrice = 0;
                Object.values(baseToppings).forEach(baseToppingObj => {
                    Object.values(baseToppingObj).forEach(qty => {
                        toppingPrice += qty * 15;
                    });
                });
                totalPrice = basePrice + toppingPrice;
            }
            
            if (totalBrownieCount > 0) {
                summaryHTML += `<div class="mt-4 pt-4 border-t border-gray-300 font-semibold text-lg">
                    <div>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡∏£‡∏ß‡∏°: ${totalBrownieCount} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                </div>`;
            }
            
            summaryContent.innerHTML = summaryHTML;
            summarySection.classList.remove('hidden');
            summarySection.classList.add('slide-down');
            
            totalPriceElement.textContent = totalPrice;
            checkOrderBtn.disabled = totalPrice === 0;
        }

        function showOrderCheck() {
            const modal = document.getElementById('order-modal');
            const finalSummary = document.getElementById('final-summary');
            const guestInfoForm = document.getElementById('guest-info-form');
            const memberButtons = document.getElementById('member-buttons');
            
            let summaryHTML = '';
            let totalPrice = 0;
            let totalBrownieCount = 0;
            
            const selectedBaseCount = Object.keys(selectedBases).length;
            
            if (selectedBaseCount === 1) {
                // Single base mode
                Object.entries(selectedBases).forEach(([base, quantity]) => {
                    totalBrownieCount += quantity;
                    summaryHTML += `<div class="mb-2"><strong>${baseNames[base]} x ${quantity} ‡∏ä‡∏¥‡πâ‡∏ô</strong></div>`;
                });
                
                if (Object.keys(selectedToppings).length > 0) {
                    summaryHTML += '<div class="mb-2"><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</strong></div>';
                    Object.entries(selectedToppings).forEach(([topping, quantity]) => {
                        summaryHTML += `<div class="ml-4 text-sm">‚Ä¢ ${toppingNames[topping]} x ${quantity} ‡∏ä‡∏¥‡πâ‡∏ô</div>`;
                    });
                }
                
                const basePrice = totalBrownieCount * 25;
                const toppingPrice = Object.values(selectedToppings).reduce((sum, qty) => sum + qty, 0) * 15;
                totalPrice = basePrice + toppingPrice;
                
            } else if (selectedBaseCount > 1) {
                // Multiple base mode
                Object.entries(selectedBases).forEach(([base, quantity]) => {
                    totalBrownieCount += quantity;
                    summaryHTML += `<div class="mb-2"><strong>${baseNames[base]} x ${quantity} ‡∏ä‡∏¥‡πâ‡∏ô</strong></div>`;
                    
                    if (baseToppings[base]) {
                        Object.entries(baseToppings[base]).forEach(([topping, toppingQty]) => {
                            summaryHTML += `<div class="ml-4 text-sm">‚Ä¢ ‡∏´‡∏ô‡πâ‡∏≤ ${toppingNames[topping]} x ${toppingQty} ‡∏ä‡∏¥‡πâ‡∏ô</div>`;
                        });
                    }
                    summaryHTML += '<div class="mb-1"></div>';
                });
                
                const basePrice = totalBrownieCount * 25;
                let toppingPrice = 0;
                Object.values(baseToppings).forEach(baseToppingObj => {
                    Object.values(baseToppingObj).forEach(qty => {
                        toppingPrice += qty * 15;
                    });
                });
                totalPrice = basePrice + toppingPrice;
            }
            
            summaryHTML += `<div class="mt-4 pt-4 border-t border-gray-300 text-lg font-bold">
                <div>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πà‡∏£‡∏ß‡∏°: ${totalBrownieCount} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                <div>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalPrice} ‡∏ö‡∏≤‡∏ó</div>
            </div>`;
            
            finalSummary.innerHTML = summaryHTML;
            
            // Show appropriate form based on login status
            if (isLoggedIn && currentUser) {
                // Member - show regular buttons
                guestInfoForm.classList.add('hidden');
                memberButtons.classList.remove('hidden');
            } else {
                // Guest - show information form
                guestInfoForm.classList.remove('hidden');
                memberButtons.classList.add('hidden');
                // Clear previous guest data
                document.getElementById('guest-name').value = '';
                document.getElementById('guest-line').value = '';
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('fade-in');
        }

        function closeOrderModal() {
            document.getElementById('order-modal').classList.add('hidden');
        }

        function handleGuestOrder(event) {
            event.preventDefault();
            
            const guestName = document.getElementById('guest-name').value;
            const guestLine = document.getElementById('guest-line').value;
            
            if (guestName && guestLine) {
                // Create guest user object for this order
                const guestUser = {
                    name: guestName,
                    lineName: guestLine,
                    isGuest: true
                };
                
                // Process the order with guest information
                confirmOrderWithUser(guestUser);
            }
        }

        function confirmOrder() {
            // For members, call confirmOrderWithUser with current user
            confirmOrderWithUser(currentUser);
        }

        function confirmOrderWithUser(user) {
            const totalPrice = parseInt(document.getElementById('total-price').textContent);
            const earnedPoints = totalPrice;
            
            // Create order record with user information
            const orderData = createOrderRecord(totalPrice, earnedPoints, user);
            
            if (isLoggedIn && currentUser && !user.isGuest) {
                // Update points only if logged in member
                currentUser.points += earnedPoints;
                currentPoints = currentUser.points;
                document.getElementById('points').textContent = currentUser.points;
                
                // Add to order history
                if (!currentUser.orderHistory) {
                    currentUser.orderHistory = [];
                }
                currentUser.orderHistory.unshift(orderData);
                
                // Show floating coins animation
                createFloatingCoins();
                
                showSuccessMessage(`‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏° +${earnedPoints} ‡πÅ‡∏ï‡πâ‡∏°!`);
            } else {
                // Guest user - no points
                if (user.isGuest) {
                    showSuccessMessage(`‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∏‡∏ì ${user.name}<br><span class="text-sm text-yellow-200">üí° ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°!</span>`);
                } else {
                    showSuccessMessage(`‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br><span class="text-sm text-yellow-200">üí° ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°!</span>`);
                }
            }
            
            // Reset form
            setTimeout(() => {
                resetForm();
                closeOrderModal();
            }, 3000);
        }



        function resetForm() {
            selectedBases = {};
            selectedToppings = {};
            baseToppings = {};
            
            // Reset base UI
            document.querySelectorAll('.brownie-base').forEach(el => {
                el.classList.remove('selected');
                const controls = el.querySelector('.base-quantity-controls');
                if (controls) {
                    controls.classList.add('hidden');
                    controls.querySelector('.base-quantity').textContent = '0';
                }
            });
            
            // Reset single base topping UI
            document.querySelectorAll('#single-base-toppings .topping-item').forEach(el => {
                el.classList.remove('topping-selected');
                const controls = el.querySelector('.quantity-controls');
                if (controls) {
                    controls.classList.add('hidden');
                    controls.querySelector('.quantity').textContent = '0';
                }
            });
            
            // Reset multiple base topping UI
            document.querySelectorAll('#multiple-base-toppings .topping-item').forEach(el => {
                el.classList.remove('topping-selected');
                const quantitySpan = el.querySelector('.base-topping-quantity span');
                if (quantitySpan) {
                    quantitySpan.textContent = '0 ‡∏ä‡∏¥‡πâ‡∏ô';
                }
            });
            
            document.getElementById('toppings-section').classList.add('hidden');
            document.getElementById('order-summary').classList.add('hidden');
            document.getElementById('total-price').textContent = '0';
            document.getElementById('check-order-btn').disabled = true;
        }

        function createOrderRecord(totalPrice, earnedPoints, user) {
            const now = new Date();
            const orderNumber = 'BR' + now.getTime().toString().slice(-6);
            
            let items = [];
            let totalBrownieCount = 0;
            
            const selectedBaseCount = Object.keys(selectedBases).length;
            
            if (selectedBaseCount === 1) {
                // Single base mode
                Object.entries(selectedBases).forEach(([base, quantity]) => {
                    totalBrownieCount += quantity;
                    items.push({
                        type: 'base',
                        name: baseNames[base],
                        quantity: quantity,
                        price: quantity * 25
                    });
                });
                
                Object.entries(selectedToppings).forEach(([topping, quantity]) => {
                    items.push({
                        type: 'topping',
                        name: toppingNames[topping],
                        quantity: quantity,
                        price: quantity * 15
                    });
                });
            } else if (selectedBaseCount > 1) {
                // Multiple base mode
                Object.entries(selectedBases).forEach(([base, quantity]) => {
                    totalBrownieCount += quantity;
                    items.push({
                        type: 'base',
                        name: baseNames[base],
                        quantity: quantity,
                        price: quantity * 25
                    });
                    
                    if (baseToppings[base]) {
                        Object.entries(baseToppings[base]).forEach(([topping, toppingQty]) => {
                            items.push({
                                type: 'topping',
                                name: `‡∏´‡∏ô‡πâ‡∏≤ ${toppingNames[topping]} (${baseNames[base]})`,
                                quantity: toppingQty,
                                price: toppingQty * 15
                            });
                        });
                    }
                });
            }
            
            return {
                orderNumber: orderNumber,
                date: now.toLocaleDateString('th-TH', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                customerName: user ? user.name : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                customerLine: user ? user.lineName : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                isGuest: user ? user.isGuest : false,
                items: items,
                totalBrownieCount: totalBrownieCount,
                totalPrice: totalPrice,
                earnedPoints: earnedPoints,
                status: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'
            };
        }

        function showOrderHistory() {
            const modal = document.getElementById('history-modal');
            const content = document.getElementById('history-content');
            
            if (!isLoggedIn || !currentUser || !currentUser.orderHistory || currentUser.orderHistory.length === 0) {
                content.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üìã</div>
                        <p class="text-gray-500 text-lg">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>
                        <p class="text-gray-400 text-sm mt-2">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                    </div>
                `;
            } else {
                let historyHTML = '';
                
                currentUser.orderHistory.forEach((order, index) => {
                    historyHTML += `
                        <div class="bg-gray-50 rounded-xl p-4 mb-4 border border-gray-200">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <h4 class="font-semibold text-gray-800">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ #${order.orderNumber}</h4>
                                    <p class="text-sm text-gray-600">${order.date}</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-emerald-600">${order.totalPrice} ‡∏ö‡∏≤‡∏ó</div>
                                    <div class="text-sm text-amber-600">+${order.earnedPoints} ‡πÅ‡∏ï‡πâ‡∏°</div>
                                </div>
                            </div>
                            
                            <div class="space-y-1 mb-3">
                                ${order.items.map(item => `
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-700">${item.name} x ${item.quantity}</span>
                                        <span class="text-gray-600">${item.price} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="flex items-center justify-between pt-3 border-t border-gray-300">
                                <div class="text-sm text-gray-600">
                                    ‡∏£‡∏ß‡∏° ${order.totalBrownieCount} ‡∏ä‡∏¥‡πâ‡∏ô
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full">
                                        ${order.status}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                content.innerHTML = historyHTML;
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('fade-in');
        }

        function closeHistoryModal() {
            document.getElementById('history-modal').classList.add('hidden');
        }

        function createFloatingCoins() {
            const container = document.getElementById('floating-coins');
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const coin = document.createElement('div');
                    coin.innerHTML = 'ü™ô';
                    coin.className = 'absolute text-4xl coin-float';
                    coin.style.left = Math.random() * window.innerWidth + 'px';
                    coin.style.top = window.innerHeight - 100 + 'px';
                    
                    container.appendChild(coin);
                    
                    setTimeout(() => {
                        container.removeChild(coin);
                    }, 2000);
                }, i * 200);
            }
        }

        // Mode Selection Functions
        function selectMode(mode) {
            if (mode === 'guest') {
                // Guest mode - go directly to app
                isLoggedIn = false;
                currentUser = null;
                showMainApp();
                updateHeaderDisplay();
            } else if (mode === 'member') {
                // Member mode - show login modal
                showLoginModal();
            }
        }

        function showMainApp() {
            document.getElementById('mode-selection').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('main-header').classList.remove('hidden');
        }

        function showLoginModal() {
            document.getElementById('login-modal').classList.remove('hidden');
            document.getElementById('login-modal').classList.add('fade-in');
        }

        function closeLoginModal() {
            document.getElementById('login-modal').classList.add('hidden');
            // Reset forms
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
            document.getElementById('register-username').value = '';
            document.getElementById('register-password').value = '';
            document.getElementById('register-name').value = '';
            document.getElementById('register-line').value = '';
            // Always show login form when modal is closed and reopened
            showLoginForm();
        }

        function showLoginForm() {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('register-form').classList.add('hidden');
        }

        function showRegisterForm() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            // Simulate login process
            if (username && password) {
                // Mock successful login
                isLoggedIn = true;
                currentUser = {
                    username: username,
                    name: '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ñ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©',
                    lineName: 'line_user123',
                    points: 128,
                    orderHistory: [
                        {
                            orderNumber: 'BR123456',
                            date: '15 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2567, 14:30',
                            items: [
                                { type: 'base', name: '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÇ‡∏Å‡πÇ‡∏Å‡πâ', quantity: 2, price: 50 },
                                { type: 'topping', name: '‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏ä‡∏¥‡∏û', quantity: 2, price: 30 }
                            ],
                            totalBrownieCount: 2,
                            totalPrice: 80,
                            earnedPoints: 80,
                            status: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'
                        },
                        {
                            orderNumber: 'BR789012',
                            date: '10 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2567, 16:45',
                            items: [
                                { type: 'base', name: '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', quantity: 1, price: 25 },
                                { type: 'topping', name: '‡∏≠‡∏±‡∏•‡∏°‡∏≠‡∏ô‡∏î‡πå‡πÅ‡∏ú‡πà‡∏ô', quantity: 1, price: 15 }
                            ],
                            totalBrownieCount: 1,
                            totalPrice: 40,
                            earnedPoints: 40,
                            status: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'
                        }
                    ]
                };
                
                closeLoginModal();
                showMainApp();
                updateHeaderDisplay();
                
                // Show success message
                showSuccessMessage('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö üéâ');
            }
        }

        function handleRegister(event) {
            event.preventDefault();
            
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const name = document.getElementById('register-name').value;
            const lineName = document.getElementById('register-line').value;
            
            // Simulate registration process
            if (username && password && name && lineName) {
                // Mock successful registration
                isLoggedIn = true;
                currentUser = {
                    username: username,
                    name: name,
                    lineName: lineName,
                    points: 50 // Welcome bonus
                };
                currentPoints = 50;
                
                closeLoginModal();
                showMainApp();
                updateHeaderDisplay();
                
                // Show success message
                showSuccessMessage(`‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${name} üéâ<br>‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö 50 ‡πÅ‡∏ï‡πâ‡∏°!`);
            }
        }

        function updateHeaderDisplay() {
            const guestStatus = document.getElementById('guest-status');
            const userStatus = document.getElementById('user-status');
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const historyBtn = document.getElementById('history-btn');
            const pointsElement = document.getElementById('points');
            
            if (isLoggedIn && currentUser) {
                // Show logged in state
                guestStatus.classList.add('hidden');
                userStatus.classList.remove('hidden');
                loginBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                historyBtn.classList.remove('hidden');
                pointsElement.textContent = currentUser.points || currentPoints;
            } else {
                // Show guest state
                guestStatus.classList.remove('hidden');
                userStatus.classList.add('hidden');
                loginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                historyBtn.classList.add('hidden');
                pointsElement.textContent = '0';
            }
        }

        function toggleLogin() {
            if (isLoggedIn) {
                // Logout
                isLoggedIn = false;
                currentUser = null;
                currentPoints = 0;
                
                // Reset to mode selection
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('main-header').classList.add('hidden');
                document.getElementById('mode-selection').classList.remove('hidden');
                
                // Reset form
                resetForm();
                
                showSuccessMessage('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            } else {
                // Always show login form first when clicking login button
                showLoginForm();
                showLoginModal();
            }
        }

        function showSuccessMessage(message) {
            const successMessage = document.getElementById('success-message');
            const successText = document.getElementById('success-text');
            successText.innerHTML = message;
            successMessage.classList.remove('hidden');
            
            setTimeout(() => {
                successMessage.classList.add('hidden');
            }, 4000);
        }

        // Close modal when clicking outside
        document.getElementById('order-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeOrderModal();
            }
        });

        document.getElementById('login-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeLoginModal();
            }
        });

        document.getElementById('history-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeHistoryModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'993fa935f66ef4cf',t:'MTc2MTM3Mzc4MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
